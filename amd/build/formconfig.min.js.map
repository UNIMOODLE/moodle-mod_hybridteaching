{"version":3,"file":"formconfig.min.js","sources":["../src/formconfig.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * The main mod_hybridteaching configuration form js.\n *\n * @copyright   2023 isyc <isyc@example.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\n/**\n * Get all selectors in one place.\n *\n */\nconst ELEMENT_SELECTOR = {\n    useAttendance: () => document.getElementById('id_useattendance'),\n    useVC: () => document.getElementById('id_usevideoconference'),\n    useVCRecord: () => document.getElementById('id_userecordvc'),\n    typeVC: () => document.getElementById('id_typevc'),\n    recordOptions: () => document.getElementById('id_sectionrecording'),\n    sectionAttendance: () => document.getElementById('id_sectionattendance'),\n    sectionAccess: () => document.getElementById('id_sectionsessionaccess'),\n    sectionInitialStatus: () => document.getElementById('id_sectioninitialstates'),\n    sectionAudience: () => document.getElementById('id_sectionaudience'),\n    participantList: () => document.getElementsByName('participants')[0],\n    modStandardGrade: () => document.getElementById('id_modstandardgrade'),\n    sessionscheduling: () => document.getElementById('id_sessionscheduling'),\n    permisionscontainer: () => document.getElementById('id_sectionaudiencecontainer'),\n};\n\n//initialformi check fun on change typevc;\nexport const init = () => {\n    /**\n     * Page load actions and events.\n     */\n    useVC();\n    useAttendance();\n    useSessionsScheduling();\n    vcInitialStatus(ELEMENT_SELECTOR.typeVC());\n    // Event listeners.\n    ELEMENT_SELECTOR.useVCRecord().addEventListener('change', (e) => useVCRecord(e));\n    ELEMENT_SELECTOR.useVC().addEventListener('change', (e) => useVC(e));\n    ELEMENT_SELECTOR.useAttendance().addEventListener('change', () => useAttendance());\n    ELEMENT_SELECTOR.sessionscheduling().addEventListener('change', () => useSessionsScheduling());\n    ELEMENT_SELECTOR.permisionscontainer().querySelector('[name=\"hybridteaching_participant_selection\"').disabled = true;\n    ELEMENT_SELECTOR.typeVC().addEventListener('change', (e) => vcInitialStatus(e.target));\n};\n\nconst useSessionsScheduling = (e = ELEMENT_SELECTOR.sessionscheduling()) => {\n    let sessionscheduling = ELEMENT_SELECTOR.sessionscheduling();\n    let sectionsessions = sessionscheduling.closest('#id_sectionsessions');\n    if (is_checkbox_checked(e) && is_element_displayed(e)) {\n        sectionsessions.querySelector('#fitem_id_starttime').setAttribute('style', 'display:none');\n        sectionsessions.querySelector('#fgroup_id_durationgroup').setAttribute('style', 'display:none');\n        sectionsessions.querySelector('#id_duration').value = 0;\n        sectionsessions.querySelector('#id_starttime_enabled').checked = 0;\n\n    } else {\n        sectionsessions.querySelector('#fitem_id_starttime').setAttribute('style', 'display:flex');\n        sectionsessions.querySelector('#fgroup_id_durationgroup').setAttribute('style', 'display:flex');\n        sectionsessions.querySelector('#fitem_id_starttime').value = 0;\n\n    }\n\n};\n\nconst useAttendance = (e = ELEMENT_SELECTOR.useAttendance()) => {\n    let sectionAttendance = ELEMENT_SELECTOR.sectionAttendance();\n    let formi = sectionAttendance.getElementsByTagName('INPUT');\n    let modStandardGrade = ELEMENT_SELECTOR.modStandardGrade();\n    let gradeformselect = modStandardGrade.getElementsByTagName('SELECT')[0];\n    if (is_checkbox_checked(e) && is_element_displayed(e)) {\n        formi.forEach(input => {\n            if (input.type !== 'hidden' && input.type !== 'text') {\n                input.value = 1;\n            }\n        });\n        sectionAttendance.setAttribute('style', 'display:block');\n\n        gradeformselect.value = 'point';\n        modStandardGrade.setAttribute('style', 'display:block');\n    } else {\n        formi.forEach(input => {\n            if (input.type !== 'hidden') {\n                input.value = '';\n            }\n        });\n        sectionAttendance.setAttribute('style', 'display:none');\n\n        gradeformselect.value = 'none';\n        modStandardGrade.setAttribute('style', 'display:none');\n    }\n\n};\n\nconst useVC = (e = ELEMENT_SELECTOR.useVC()) => {\n    let recordoptions = ELEMENT_SELECTOR.useVCRecord();\n    let typeVC = ELEMENT_SELECTOR.typeVC();\n    let sectionAccess = ELEMENT_SELECTOR.sectionAccess();\n    let accessformi = sectionAccess.getElementsByTagName('INPUT');\n    let sectionInitialStatus = ELEMENT_SELECTOR.sectionInitialStatus();\n    let initialformi = sectionInitialStatus.getElementsByTagName('INPUT');\n    let sectionAudience = ELEMENT_SELECTOR.sectionAudience();\n    let participantList = ELEMENT_SELECTOR.participantList();\n    let oldtypevc = ELEMENT_SELECTOR.typeVC().value;\n    let plistold = participantList.value;\n    if (is_checkbox_checked(e) && is_element_displayed(e)) {\n        recordoptions.value = 1;\n        typeVC.value = oldtypevc;\n        recordoptions.closest('.form-group').setAttribute('style', 'display:flex');\n        typeVC.closest('.form-group').setAttribute('style', 'display:flex');\n\n        accessformi.forEach(accesinput => {\n            if (accesinput.type !== 'hidden'&& accesinput.type !== 'text') {\n                accesinput.value = 1;\n            }\n        });\n        sectionAccess.setAttribute('style', 'display:block');\n\n        initialformi.forEach(initialinput => {\n            if (initialinput.type !== 'hidden'&& initialinput.type !== 'text') {\n                initialinput.value = 1;\n            }\n        });\n        sectionInitialStatus.setAttribute('style', 'display:block');\n\n        if (typeof plistold !== 'undefined') {\n            participantList.value = plistold;\n        }\n        sectionAudience.setAttribute('style', 'display:block');\n\n    } else {\n        recordoptions.value = 0;\n        oldtypevc = typeVC.value;\n        typeVC.value = 0;\n        recordoptions.closest('.form-group').setAttribute('style', 'display:none');\n        typeVC.closest('.form-group').setAttribute('style', 'display:none');\n        accessformi.forEach(accesinput => {\n            if (accesinput.type !== 'hidden') {\n                accesinput.value = 0;\n            }\n        });\n        sectionAccess.setAttribute('style', 'display:none');\n\n        initialformi.forEach(initialinput => {\n            if (initialinput.type !== 'hidden') {\n                initialinput.value = 0;\n            }\n        });\n        sectionInitialStatus.setAttribute('style', 'display:none');\n\n        plistold = participantList.value;\n        participantList.value = '[]';\n        sectionAudience.setAttribute('style', 'display:none');\n    }\n    useVCRecord();\n};\n\nconst useVCRecord = (e = ELEMENT_SELECTOR.useVCRecord()) => {\n    let recordOptions = ELEMENT_SELECTOR.recordOptions();\n    let formi = recordOptions.getElementsByTagName('INPUT');\n    if (is_checkbox_checked(e) && is_element_displayed(e)) {\n        formi.forEach(input => {\n            if (input.type !== 'hidden' && input.type !== 'text') {\n                input.value = 1;\n            }\n        });\n        recordOptions.setAttribute('style', 'display:block');\n    } else {\n        formi.forEach(input => {\n            if (input.type !== 'hidden') {\n                input.value = 0;\n            }\n        });\n        recordOptions.setAttribute('style', 'display:none');\n    }\n\n};\n\nconst is_checkbox_checked = (e) => {\n    if (e.target !== undefined) {\n        return e.target.checked;\n    } return e.checked;\n};\n\nconst is_element_displayed = (e) => {\n    let displayed;\n    if (e.target !== undefined) {\n        displayed = window.getComputedStyle(e.target.closest('.form-group'), null).display;\n    } else {\n        displayed = window.getComputedStyle(e.closest('.form-group'), null).display;\n    }\n    return displayed != 'none';\n};\n\nconst vcInitialStatus = (e) => {\n    let target = (e);\n    if ( target.options[target.selectedIndex] === undefined) {\n        return null;\n    }\n    let vctypevalue = target.options[target.selectedIndex].value;\n    let regex = /[A-Za-z]+/i;\n    let vctype = vctypevalue.match(regex)[0];\n    let validStatus = [];\n    let disabledOptions = [];\n    validStatus['vc'] = ELEMENT_SELECTOR.sectionInitialStatus().querySelectorAll('input:not([type=hidden])');\n    validStatus['store'] = ELEMENT_SELECTOR.recordOptions().querySelectorAll('input:not([type=hidden])');\n    switch (vctype) {\n        case 'bbb':\n            disabledOptions = ['id_downloadrecords'];\n            break;\n        case 'meet':\n            disabledOptions = ['id_disablecam', 'id_disablemic', 'id_disableprivatechat', 'id_disablepublicchat',\n                'id_disablenote', 'id_hideuserlist', 'id_blockroomdesign', 'id_ignorelocksettings',\n                'id_initialrecord', 'id_hiderecordbutton'];\n            break;\n        case 'teams':\n            disabledOptions = ['id_disableprivatechat', 'id_disablenote', 'id_hideuserlist', 'id_blockroomdesign',\n                'id_ignorelocksettings', 'id_hiderecordbutton', 'id_showpreviewrecord'];\n            break;\n        case 'zoom':\n            disabledOptions = ['id_disableprivatechat', 'id_disablepublicchat', 'id_disablenote', 'id_hideuserlist',\n                'id_blockroomdesign', 'id_ignorelocksettings', 'id_initialrecord', 'id_hiderecordbutton',\n                'id_showpreviewrecord'];\n            break;\n        default:\n            break;\n    }\n    vcInitialStatusDisplay(validStatus['vc'], validStatus['store'], disabledOptions, vctype).then();\n};\n\nconst vcInitialStatusDisplay = async(vc, store, conditions, vctype) => {\n    const nostateconfig = await getString('noinitialstateconfig', 'mod_hybridteaching');\n    let disabledOptions = conditions;\n    vc.forEach(input => {\n        if (disabledOptions.includes(input.id)) {\n            input.closest('.row.fitem').setAttribute('style', 'display:none;');\n            input.value = 0;\n        } else {\n            input.closest('.row.fitem').setAttribute('style', 'display:flex;');\n            input.value = 1;\n        }\n    });\n    store.forEach(input => {\n        if (disabledOptions.includes(input.id)) {\n            input.closest('.row.fitem').setAttribute('style', 'display:none;');\n            input.value = 0;\n        } else {\n            input.closest('.row.fitem').setAttribute('style', 'display:flex;');\n            input.value = 1;\n        }\n    });\n    if (vctype === 'meet') {\n        if (document.getElementById('nostateconfig') !== null) {\n            document.getElementById('nostateconfig').setAttribute('style', 'display:flex');\n        } else {\n            let stateNode = document.createElement('p');\n            stateNode.append(nostateconfig);\n            stateNode.setAttribute('id', 'nostateconfig');\n            stateNode.setAttribute('class', 'text-info');\n            document.getElementById('id_sectioninitialstatescontainer').appendChild(stateNode);\n        }\n    } else {\n        if (document.getElementById('nostateconfig') !== null) {\n            document.getElementById('nostateconfig').setAttribute('style', 'display:none');\n        }\n    }\n};\n"],"names":["ELEMENT_SELECTOR","document","getElementById","getElementsByName","useVC","useAttendance","useSessionsScheduling","vcInitialStatus","addEventListener","e","useVCRecord","querySelector","disabled","target","sessionscheduling","sectionsessions","closest","is_checkbox_checked","is_element_displayed","setAttribute","value","checked","sectionAttendance","formi","getElementsByTagName","modStandardGrade","gradeformselect","forEach","input","type","recordoptions","typeVC","sectionAccess","accessformi","sectionInitialStatus","initialformi","sectionAudience","participantList","oldtypevc","plistold","accesinput","initialinput","recordOptions","undefined","displayed","window","getComputedStyle","display","options","selectedIndex","vctype","match","validStatus","disabledOptions","querySelectorAll","vcInitialStatusDisplay","then","async","vc","store","conditions","nostateconfig","includes","id","stateNode","createElement","append","appendChild"],"mappings":"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"}