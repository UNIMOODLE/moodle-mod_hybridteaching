{"version":3,"file":"attendance.min.js","sources":["../src/attendance.js"],"sourcesContent":["define([\n    'core/ajax'\n], function(ajax) {\n    const manualattendance = async(e) => {\n        var att = e.currentTarget;\n        var attid = att.closest('tr').querySelector('[id^=\"' + 'attendance' + '\"]').value;\n        var id = document.getElementsByName('id')[0].value;\n        if (att.checked) {\n            set_manual_attendance(attid, 1, id);\n        } else {\n            set_manual_attendance(attid, 0, id);\n        }\n    };\n\n    /**\n     * Sets manual attendance\n     *\n     * @param {integer} attid\n     * @param {array} status\n     * @param {string} id (cmid)\n     * @returns response with the modified slot information.\n     */\n    const set_manual_attendance = (attid, status, id) => ajax.call([{\n        methodname: 'mod_hybridteaching_set_manual_attendance',\n        args: {\n            attid,\n            status,\n            id,\n        },\n    }])[0].done(response => {\n        return response;\n    }).fail(err => {\n        // eslint-disable-next-line no-console\n        console.log(err);\n    });\n\n    /**\n     * Disable check if session is in progress\n     * \n     */\n    const disable_checks_session_inprogress = () => {\n        \n        let queryString = window.location.search;\n        let urlParams = new URLSearchParams(queryString);\n        //urlParams.get('view') == \"sessionattendance\" ? document.getElementById(\"sessionattendancebtn\").style.display = \"none\" : \"\";\n        //urlParams.get('view') == \"extendedstudentatt\" ? document.getElementById(\"extendedstudentattbtn\").style.display = \"none\" : \"\";\n            \n        var hybridteachingid = urlParams.get('id');\n        var sessionid = urlParams.get('sessionid');\n        ajax.call([{\n            methodname: 'mod_hybridteaching_disable_attendance_inprogress',\n            args: {\n                hybridteachingid,\n                sessionid\n            },\n        }])[0].done(response => {\n            response = JSON.parse(response);\n            var table = document.getElementById('hybridteachingattendance');\n            \n            if (urlParams.get('view') == \"sessionattendance\" || urlParams.get('view') == null) {\n                if (Object.keys(response[0]).length > 0) {\n                    let allchecks = document.getElementById(\"select-all-attendance\");\n                    allchecks.disabled = \"true\";\n                    \n                }\n                for (var i in response[0]) {\n                    let check = document.getElementById('session-'+response[0][i].id);\n                    check.disabled = \"true\";\n                }\n            }\n            if (urlParams.get('view')==\"extendedsessionatt\") {\n                if (Object.keys(response[1]).length > 0) {\n                    let allchecks = document.getElementById(\"select-all-attendance\");\n                    allchecks.disabled = \"true\";\n                    console.log(response[1]);\n                }\n                for (var i in response[1]) {\n                    let check = document.getElementById('attendance-'+response[1][i].id);\n                    console.log(\"fila:\"+check.rowIndex)\n                    console.log(\"columna:\"+check.cellIndex)\n                    console.log(\"------------\");\n                    check.disabled = \"true\";\n                    for (var i = 1; i < table.rows.length; i++) {\n                        var rowatt = table.rows[i];\n                        var cellat = rowatt.cells[0];\n                        if (cellat.firstChild.id === check.id) {\n                            let cellatt = rowatt.cells[8].firstChild;\n                            cellatt.disabled = \"true\";\n                            console.log(cellatt);\n                        }\n                      }\n                }\n            }\n        }).fail(err => {\n            console.log(err);\n        })\n    };\n\n    return {\n        init: () => {\n            disable_checks_session_inprogress();\n            window.addEventListener(\"beforeunload\", (e) => {\n                e.stopImmediatePropagation();\n            }, true);\n            if (document.getElementById('id_perpage') !== null) {\n                document.getElementById('id_perpage').onchange = function() {\n                    let formPrefix = 'optionsform';\n                    let formElement = document.querySelector('[id^=\"' + formPrefix + '\"]');\n                    if (formElement) {\n                        formElement.submit();\n                    }\n                };\n            }\n            if (document.getElementById('id_attfilter') !== null) {\n                document.getElementById('id_attfilter').onchange = function() {\n                    let formPrefix = 'optionsform';\n                    let formElement = document.querySelector('[id^=\"' + formPrefix + '\"]');\n                    if (formElement) {\n                        formElement.submit();\n                    }\n                };\n            }\n            if (document.getElementById('id_groupid') !== null) {\n                document.getElementById('id_groupid').onchange = function() {\n                    let formPrefix = 'optionsform';\n                    let formElement = document.querySelector('[id^=\"' + formPrefix + '\"]');\n                    if (formElement) {\n                        formElement.submit();\n                    }\n                };\n            }\n            if (document.getElementById('id_selectedsession') !== null) {\n                document.getElementById('id_selectedsession').onchange = function() {\n                    let formPrefix = 'sessionsform';\n                    let formElement = document.querySelector('[id^=\"' + formPrefix + '\"]');\n                    if (formElement) {\n                        formElement.submit();\n                    }\n                };\n            }\n            if (document.getElementById('id_selecteduser') !== null) {\n                document.getElementById('id_selecteduser').onchange = function() {\n                    let formPrefix = 'sessionsform';\n                    let formElement = document.querySelector('[id^=\"' + formPrefix + '\"]');\n                    if (formElement) {\n                        formElement.submit();\n                    }\n                };\n            }\n            var manualatt = document.querySelectorAll('.attendance-validated');\n            manualatt.forEach(att => {\n                att.addEventListener('change', manualattendance, true);\n            });\n            \n        }\n    };\n});\n"],"names":["define","ajax","manualattendance","async","att","e","currentTarget","attid","closest","querySelector","value","id","document","getElementsByName","checked","set_manual_attendance","status","call","methodname","args","done","response","fail","err","console","log","init","queryString","window","location","search","urlParams","URLSearchParams","hybridteachingid","get","sessionid","JSON","parse","table","getElementById","i","Object","keys","length","disabled","check","rowIndex","cellIndex","rows","rowatt","cells","firstChild","cellatt","disable_checks_session_inprogress","addEventListener","stopImmediatePropagation","onchange","formElement","submit","querySelectorAll","forEach"],"mappings":"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"}