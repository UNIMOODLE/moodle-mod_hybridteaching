define("mod_hybridteaching/formconfig",["exports","core/str","core/ajax"],(function(_exports,_str,_ajax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * The main mod_hybridteaching configuration form js.
   *
   * @copyright   2023 isyc <isyc@example.com>
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var cmgroupmodeselector=null;void 0!==document.getElementsByName("cmgroupmode")[0]&&(cmgroupmodeselector=document.getElementsByName("cmgroupmode")[0].value);const ELEMENT_SELECTOR_useAttendance=()=>document.getElementById("id_useattendance"),ELEMENT_SELECTOR_useVC=()=>document.getElementById("id_usevideoconference"),ELEMENT_SELECTOR_useVCRecord=()=>document.getElementById("id_userecordvc"),ELEMENT_SELECTOR_typeVC=()=>document.getElementById("id_typevc"),ELEMENT_SELECTOR_recordOptions=()=>document.getElementById("id_sectionrecording"),ELEMENT_SELECTOR_sectionAttendance=()=>document.getElementById("id_sectionattendance"),ELEMENT_SELECTOR_sectionAccess=()=>document.getElementById("id_sectionsessionaccess"),ELEMENT_SELECTOR_sectionInitialStatus=()=>document.getElementById("id_sectioninitialstates"),ELEMENT_SELECTOR_sectionAudience=()=>document.getElementById("id_sectionaudience"),ELEMENT_SELECTOR_participantList=()=>document.getElementsByName("participants")[0],ELEMENT_SELECTOR_modStandardGrade=()=>document.getElementById("id_modstandardgrade"),ELEMENT_SELECTOR_sessionscheduling=()=>document.getElementById("id_sessionscheduling"),ELEMENT_SELECTOR_permisionscontainer=()=>document.getElementById("id_sectionaudiencecontainer"),ELEMENT_SELECTOR_groupmode=()=>document.getElementById("id_groupmode"),ELEMENT_SELECTOR_cmgroupmode=()=>cmgroupmodeselector,ELEMENT_SELECTOR_pagecontext=()=>get_page_context(document.getElementsByTagName("body")[0].getAttribute("class"));var plistold=ELEMENT_SELECTOR_participantList().value;const userrecordingcapability=(typevc,pagecontext)=>(0,_ajax.call)([{methodname:"mod_hybridteaching_user_has_recording_capability",args:{typevc:typevc,pagecontext:pagecontext}}])[0].done((response=>response)).fail((err=>{console.log(err)}));_exports.init=()=>{useVC(),useAttendance(),useGroupMode(ELEMENT_SELECTOR_sessionscheduling()).then(),useSessionsScheduling(),vcInitialStatus(ELEMENT_SELECTOR_typeVC()),ELEMENT_SELECTOR_useVCRecord().addEventListener("change",(e=>useVCRecord(e))),ELEMENT_SELECTOR_useVC().addEventListener("change",(e=>useVC(e))),ELEMENT_SELECTOR_useAttendance().addEventListener("change",(()=>useAttendance())),ELEMENT_SELECTOR_sessionscheduling().addEventListener("change",(()=>useSessionsScheduling())),ELEMENT_SELECTOR_permisionscontainer().querySelector('[name="hybridteaching_participant_selection"').disabled=!0,ELEMENT_SELECTOR_typeVC().addEventListener("change",(e=>vcInitialStatus(e.target))),ELEMENT_SELECTOR_typeVC().addEventListener("change",(e=>useVCRecord())),ELEMENT_SELECTOR_sessionscheduling().addEventListener("change",(e=>useGroupMode(e.target)))};const useSessionsScheduling=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ELEMENT_SELECTOR_sessionscheduling(),sessionscheduling=ELEMENT_SELECTOR_sessionscheduling(),sectionsessions=sessionscheduling.closest("#id_sectionsessions");is_checkbox_checked(e)&&is_element_displayed(e)?(sectionsessions.querySelector("#fitem_id_starttime").setAttribute("style","display:none"),sectionsessions.querySelector("#fgroup_id_durationgroup").setAttribute("style","display:none"),sectionsessions.querySelector("#id_duration").value=0,sectionsessions.querySelector("#id_starttime_enabled").checked=0):(sectionsessions.querySelector("#fitem_id_starttime").setAttribute("style","display:flex"),sectionsessions.querySelector("#fgroup_id_durationgroup").setAttribute("style","display:flex"),sectionsessions.querySelector("#fitem_id_starttime").value=0)},useAttendance=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ELEMENT_SELECTOR_useAttendance(),sectionAttendance=ELEMENT_SELECTOR_sectionAttendance(),formi=sectionAttendance.getElementsByTagName("INPUT"),modStandardGrade=ELEMENT_SELECTOR_modStandardGrade(),gradeformselect=modStandardGrade.getElementsByTagName("SELECT")[0];is_checkbox_checked(e)&&is_element_displayed(e)?(formi.forEach((input=>{"hidden"!==input.type&&"text"!==input.type&&(input.value=1)})),sectionAttendance.setAttribute("style","display:block"),modStandardGrade.setAttribute("style","display:block")):(formi.forEach((input=>{"hidden"!==input.type&&(input.value="")})),sectionAttendance.setAttribute("style","display:none"),gradeformselect.value="none",modStandardGrade.setAttribute("style","display:none"))},useVC=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ELEMENT_SELECTOR_useVC(),recordoptions=ELEMENT_SELECTOR_useVCRecord(),typeVC=ELEMENT_SELECTOR_typeVC(),sectionAccess=ELEMENT_SELECTOR_sectionAccess(),accessformi=sectionAccess.getElementsByTagName("INPUT"),sectionInitialStatus=ELEMENT_SELECTOR_sectionInitialStatus(),initialformi=sectionInitialStatus.getElementsByTagName("INPUT"),sectionAudience=ELEMENT_SELECTOR_sectionAudience(),participantList=ELEMENT_SELECTOR_participantList(),oldtypevc=ELEMENT_SELECTOR_typeVC().value;is_checkbox_checked(e)&&is_element_displayed(e)?(recordoptions.value=1,typeVC.value=oldtypevc,recordoptions.closest(".form-group").setAttribute("style","display:flex"),typeVC.closest(".form-group").setAttribute("style","display:flex"),accessformi.forEach((accesinput=>{"hidden"!==accesinput.type&&"text"!==accesinput.type&&(accesinput.value=1)})),sectionAccess.setAttribute("style","display:block"),initialformi.forEach((initialinput=>{"hidden"!==initialinput.type&&"text"!==initialinput.type&&(initialinput.value=1)})),sectionInitialStatus.setAttribute("style","display:block"),void 0!==plistold&&(participantList.value=plistold),sectionAudience.setAttribute("style","display:block")):(recordoptions.value=0,oldtypevc=typeVC.value,typeVC.value=0,recordoptions.closest(".form-group").setAttribute("style","display:none"),typeVC.closest(".form-group").setAttribute("style","display:none"),accessformi.forEach((accesinput=>{"hidden"!==accesinput.type&&(accesinput.value=0)})),sectionAccess.setAttribute("style","display:none"),initialformi.forEach((initialinput=>{"hidden"!==initialinput.type&&(initialinput.value=0)})),sectionInitialStatus.setAttribute("style","display:none"),plistold=participantList.value,sectionAudience.setAttribute("style","display:none")),useVCRecord()},useVCRecord=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ELEMENT_SELECTOR_useVCRecord(),recordOptions=ELEMENT_SELECTOR_recordOptions(),formi=recordOptions.getElementsByTagName("INPUT"),typevc=get_vc_type(ELEMENT_SELECTOR_typeVC().value);const norecordingcap=await(0,_str.get_string)("norecordingmoderation","hybridteaching");userrecordingcapability(typevc,ELEMENT_SELECTOR_pagecontext()).done((r=>{if(JSON.parse(r))ELEMENT_SELECTOR_useVCRecord().removeAttribute("disabled"),null!==document.getElementById("norecordingcap")&&ELEMENT_SELECTOR_useVC().checked&&document.getElementById("norecordingcap").setAttribute("style","display:none");else if(ELEMENT_SELECTOR_useVCRecord().checked=!1,ELEMENT_SELECTOR_useVCRecord().setAttribute("disabled","true"),null!==document.getElementById("norecordingcap")&&ELEMENT_SELECTOR_useVC().checked)document.getElementById("norecordingcap").setAttribute("style","display:flex");else if(ELEMENT_SELECTOR_useVC().checked){let capnode=document.createElement("p");capnode.append(norecordingcap),capnode.setAttribute("id","norecordingcap"),capnode.setAttribute("class","text-danger"),document.getElementById("id_sectiongeneralcontainer").appendChild(capnode)}})).then((function(){is_checkbox_checked(e)&&is_element_displayed(e)?(formi.forEach((input=>{"hidden"!==input.type&&"text"!==input.type&&(input.value=1)})),recordOptions.setAttribute("style","display:block")):(formi.forEach((input=>{"hidden"!==input.type&&(input.value=0)})),recordOptions.setAttribute("style","display:none"))}))},useGroupMode=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ELEMENT_SELECTOR_sessionscheduling(),groupmode=ELEMENT_SELECTOR_groupmode(),sessionscheduling=e,cmgroupmode=ELEMENT_SELECTOR_cmgroupmode();null==groupmode?0!=cmgroupmode?(sessionscheduling.setAttribute("disabled","true"),sessionscheduling.checked=!0,sessionscheduling.value=1,sessionscheduling.closest("div").querySelector('[type^="hidden"]').value=1):document.getElementById("id_groupingid").setAttribute("disabled","true"):is_checkbox_checked(sessionscheduling)?(groupmode.closest(".fitem").setAttribute("style","display:flex;"),document.getElementById("fitem_id_groupingid").setAttribute("style","display:flex;"),document.getElementById("id_groupingid").value=0):(groupmode.closest(".fitem").setAttribute("style","display:none;"),document.getElementById("fitem_id_groupingid").setAttribute("style","display:none;"),groupmode.value=0,document.getElementById("id_groupingid").value=0)},is_checkbox_checked=e=>void 0!==e.target?e.target.checked:e.checked,is_element_displayed=e=>{let displayed;return displayed=void 0!==e.target?window.getComputedStyle(e.target.closest(".form-group"),null).display:window.getComputedStyle(e.closest(".form-group"),null).display,"none"!=displayed},vcInitialStatus=e=>{let target=e;if(void 0===target.options[target.selectedIndex])return null;let vctype=target.options[target.selectedIndex].value.match(/[A-Za-z]+/i)[0],validStatus=[],disabledOptions=[];switch(validStatus.vc=ELEMENT_SELECTOR_sectionInitialStatus().querySelectorAll("input:not([type=hidden])"),validStatus.store=ELEMENT_SELECTOR_recordOptions().querySelectorAll("input:not([type=hidden])"),vctype){case"bbb":disabledOptions=["id_downloadrecords"];break;case"meet":disabledOptions=["id_disablecam","id_disablemic","id_disableprivatechat","id_disablepublicchat","id_disablenote","id_hideuserlist","id_blockroomdesign","id_ignorelocksettings","id_initialrecord","id_hiderecordbutton"];break;case"teams":disabledOptions=["id_disableprivatechat","id_disablenote","id_hideuserlist","id_blockroomdesign","id_ignorelocksettings","id_hiderecordbutton","id_showpreviewrecord"];break;case"zoom":disabledOptions=["id_disableprivatechat","id_disablepublicchat","id_disablenote","id_hideuserlist","id_blockroomdesign","id_ignorelocksettings","id_initialrecord","id_hiderecordbutton","id_showpreviewrecord"]}vcInitialStatusDisplay(validStatus.vc,validStatus.store,disabledOptions,vctype).then()},vcInitialStatusDisplay=async(vc,store,conditions,vctype)=>{const nostateconfig=await(0,_str.get_string)("noinitialstateconfig","mod_hybridteaching");let disabledOptions=conditions;if(vc.forEach((input=>{disabledOptions.includes(input.id)?(input.closest(".row.fitem").setAttribute("style","display:none;"),input.value=0):(input.closest(".row.fitem").setAttribute("style","display:flex;"),input.value=1)})),store.forEach((input=>{disabledOptions.includes(input.id)?(input.closest(".row.fitem").setAttribute("style","display:none;"),input.value=0):(input.closest(".row.fitem").setAttribute("style","display:flex;"),input.value=1)})),"meet"===vctype)if(null!==document.getElementById("nostateconfig"))document.getElementById("nostateconfig").setAttribute("style","display:flex");else{let stateNode=document.createElement("p");stateNode.append(nostateconfig),stateNode.setAttribute("id","nostateconfig"),stateNode.setAttribute("class","text-info"),document.getElementById("id_sectioninitialstatescontainer").appendChild(stateNode)}else null!==document.getElementById("nostateconfig")&&document.getElementById("nostateconfig").setAttribute("style","display:none")},get_page_context=bodyinfo=>bodyinfo.match(/context-[0-9]+/i)[0].substring(8),get_vc_type=vctype=>{if(void 0===vctype||""===vctype)return!1;return vctype.match(/-[A-Za-z]+/i)[0].substring(1)}}));

//# sourceMappingURL=formconfig.min.js.map